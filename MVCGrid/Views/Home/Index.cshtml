@model MVCGrid.Models.IndexViewModel
@using MVCGrid.Helpers;


@{
    ViewBag.Title = "Home Page";
 
  

}
    <head>
        <link href='@Url.Content("~/Content/themes/base/jquery-ui.css")' rel="stylesheet" type="text/css" />
        <link href='@Url.Content("~/Content/themes/base/all.css")' rel="stylesheet" type="text/css" />
        <link href='@Url.Content("~/Content/jquery.jqGrid/ui.jqgrid.css")' rel="stylesheet" type="text/css" />
        <script src='@Url.Content("~/Scripts/jquery-ui-1.12.1.js")' type="text/javascript"></script>
        <script src='@Url.Content("~/Scripts/jquery.jqGrid.min.js")' type="text/javascript"></script>
        <script src='@Url.Content("~/Scripts/i18n/grid.locale-ru.js")' type="text/javascript"></script>
        <style>
            .ui-jqgrid .ui-pg-input {
                height: 20px;
                width: 50px;
            }

            .ui-jqgrid .ui-jqgrid-pager {
                height: 50px;
            }
        </style>
    </head>
    <body>
        <br />

        <div><span id="notification" style="color:red;font-size:15px;"></span></div>

        <div>

            @using (Ajax.BeginForm("JSONWorkerSearch", new AjaxOptions { OnSuccess = "OnSuccess" }))
            {
                <input type="text" name="FirstName" placeholder="FirstName" data-autocomplete-source='@Url.Action("AutocompleteSearch", "Home")' />
                <input type="submit" value="Поиск" />

            }

            <script type="text/javascript">
                $(function () {
                    $("[data-autocomplete-source]").each(function () {
                        var target = $(this);
                        target.autocomplete({ source: target.attr("data-autocomplete-source") });
                    });
                });
            </script>
            <br />
            <table id="jqgrid"></table>
            <div id="jpager"></div>
            <script type="text/javascript">
                $(document).ready(function () {
                    $("#jqgrid").jqGrid({
                        url: '@Url.Action("GetData")',
                        datatype: "json",
                        colNames: ['Id', 'Имя', 'Фамилия', 'Действия'],
                        colModel: [
                            { name: 'Id', index: 'Id', width: 50, stype: 'text'  },
                            { name: 'FirstName', index: 'FirstName', width:200, sortable: true },
                            { name: 'LastName', index: 'LastName', width: 200, sortable: true },
                            { name: 'Edit', index: 'Edit', width: 150, align: "center", editable: true, formatter: actionFormater }

                        ],

                        rowNum: 10, // число отображаемых строк
                        rowList: [10, 20, 30],
                        pager: '#jpager',
                        loadonce: true, // загрузка только один раз
                        sortname: 'FirstName', // сортировка по умолчанию по столбцу Id
                        sortorder: "ASC", // порядок сортировки
                        caption: "Список работников"
                    });
                    function actionFormater(cellvalue, options, rowObject) {
                        // do something here
                        return "<a href='/Home/EditWorker/" + rowObject.Id + "' >Редатировать</a>" + "  " + "<a href='/Home/Delete/" + rowObject.Id + "' >Удалить</a>";
                    }
                    $("#jqgrid").jqGrid('navGrid', '#jpager', {

                        add: false,
                        del: false,
                        edit: false,
                        search: true,
                        searchtext: "Поиск",
                        refresh: true,
                        refreshtext: "Обновить"
                    });
                });
            </script>

            <br />
            <div id="results"></div>
        </div>
        <br />
        <div id="ShowAlcoholics">
            @Ajax.ActionLink("Показать алкоголиков", "ShowAlcoholics",
                    new AjaxOptions { UpdateTargetId = "ShowAlcoholics" })
        </div>

        <script type="text/javascript">


            function OnFailure() {
                alert("Работники с таким именем не найдены базе данных.");
            }
            function OnSuccess(data) {
                var results = $('#results'); // получаем нужный элемент
                results.empty(); //очищаем элемент
                if (data.length > 0) {
                    let div = document.createElement('div');
                    div.className = "notif";
                    div.innerHTML = "Работники с именем " + data[0].FirstName + ":";
                    results.append(div);
                    for (var i = 0; i < data.length; i++) {
                        results.append('<li>' + data[i].FirstName + ' ' + data[i].LastName + '</li>'); // добавляем данные в список
                    }
                }
                else {
                    OnFailure();
                }
            }

        </script><script src="~/Scripts/jquery.signalR-2.4.1.min.js"></script>
            <!--Ссылка на автоматически сгенерированный скрипт хаба SignalR -->
            <script src="~/signalr/hubs"></script>
            <script type="text/javascript">
                $(function () {

                    var notificationhub = $.connection.notificationHub;

                    notificationhub.client.displayMessage = function (message) {

                        $('#notification').html(message);
                        debugger;
                    };

                    $.connection.hub.start();

                });
            </script>
        

        <style>
            .notif {
                font-size: 15px;
                font-family: Verdana, Arial, Helvetica, Sans-Serif;
                font-weight: bold;
                line-height: 40px;
            }
        </style>
    </body>











